
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Puncsky CS Notebook</title>
  <meta name="author" content="Tian">

  
  <meta name="description" content="Life and computer science notebook from Puncsky">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://www.puncsky.com">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/bootstrap/bootstrap.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/stylesheets/bootstrap/responsive.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/stylesheets/syntax/syntax.css" media="screen, projection" rel="stylesheet" type="text/css">
  <style type="text/css">
    body {
      padding-bottom: 40px;
    }
    h1 {
      margin-bottom: 15px;
    }
    img {
      max-width: 100%;
    }
    .sharing, .meta, .pager {
      margin: 20px 0px 20px 0px;
    }
    .page-footer p {
      text-align: center;
    }
  </style>
  <script src="/javascripts/libs/jquery.js"></script>
  <script src="/javascripts/libs/modernizr-2.0.js"></script>
  <script src="/javascripts/libs/bootstrap.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Puncsky CS Notebook" type="application/atom+xml">
  <!--
<link href="http://fonts.googleapis.com/css?family=Ubuntu:300,400,500,700,300italic,400italic,500italic,700italic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,500italic,700italic,300,400,500,700,800" rel="stylesheet" type="text/css">
-->

<link href="http://fonts.googleapis.com/css?family=Ubuntu" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-43072488-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <nav role="navigation"><div class="navbar navbar-inverse">
  <div class="navbar-inner">
    <div class="container">
      <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </a>

      <a class="brand" href="/">Puncsky CS Notebook</a>

      <div class="nav-collapse">
        <ul class="nav">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>


        <ul class="nav pull-right" data-subscription="rss">
          <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
          
        </ul>

        
          <form class="pull-right navbar-search" action="http://google.com/search" method="get">
            <fieldset role="search">
              <input type="hidden" name="q" value="site:www.puncsky.com" />
              <input class="search-query" type="text" name="q" results="0" placeholder="Search"/>
            </fieldset>
          </form>
        
      </div>
    </div>
  </div>
</div>
</nav>
  <div class="container">
    <div class="row-fluid">
      <div class="span9">
  
  
  
    <article>
      
  <header class="page-header">
    
      <h1 class="entry-title"><a href="/blog/2013/09/05/essential-c-sharp-intermediate/">Essential C# 4.0: Intermediate</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-09-05T14:00:00-07:00" pubdate data-updated="true">Sep 5<span>th</span>, 2013</time>
        
         | <a href="/blog/2013/09/05/essential-c-sharp-intermediate/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p><a href="http://www.puncsky.com/blog/2013/08/14/essential-c-sharp-basics/">Essential C# 4.0: Basics</a>
Essential C# 4.0: Intermediate
<a href="">Essential C# 4.0: Advanced</a></p>

<p>This is the second part of my serials of notes on learning C#.</p>

<p>A productive-focused language like C# has so much <em>syntax sugar</em> that I feel not so comfortable with, because I used to be a C++ programmer and everything in the C++ kingdom appears to be straight forward, although, at the same time, tend to be fallible.</p>

<p>The most serious problem I find about Microsoft&#8217;s tools is that up there exist so many auto-generated codes that I cannot know them all in details. I mean, that is good, you can ship as much stuff as possible within limited time. The problem is, it is not good for curious people like me, nor for the beginner. Back in school, when we build something, we build it <em>from scratch</em>. Perhaps, <em>reinvent the wheel</em> is the best way to learn the wheel. IEDs such as Visual Studio and Eclipse make people so lazy and forget to remember and to think.</p>

<p>Consequently, in my spare time, I would do write every code with VIM.</p>

<p>The following is my notes from Chapter 9 through Chapter 13.</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2013/09/05/essential-c-sharp-intermediate/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header class="page-header">
    
      <h1 class="entry-title"><a href="/blog/2013/09/02/ipadmini/">我的iPad安装的应用</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-09-02T18:06:00-07:00" pubdate data-updated="true">Sep 2<span>nd</span>, 2013</time>
        
         | <a href="/blog/2013/09/02/ipadmini/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>我是电子设备阅读控，曾经使用过Kindle 3, Kindle DXG, Meizu 1, Motorola Milestone 1, Macbook Pro, AOC USB Portable Monitor，文曲星 等等一系列不同尺寸的设备阅读各色书籍。<strong>但是迄今为止，还从未有一款能够像iPad mini这般赏心悦目</strong>。为什么？因为我也同几乎所有人一样，都喜欢控制的感觉，都喜欢色彩丰富的体验；而iPad mini正是如此的流畅(responsive)，小巧，绚丽。流畅之处在于，轻轻一划便可做笔记、摘录、翻页、查词典；小巧之处在于，在保证舒适阅读的前提，尽可能地缩小尺寸，你可以在任何地方享受阅读的乐趣。</p>

<p>至于色彩，不要开玩笑LCD屏幕伤眼睛了，盯着过于明亮或者过于晦暗的事物过久都会伤眼睛；而绝大多数人可以用电脑屏幕目不转睛地看一整天视频，却抱怨不过几小时的阅读伤眼睛……真滑稽。</p>

<p>iPad不适合严肃阅读？阅读行为从来就和阅读手段没有直接的关系。<strong>认为平板游戏让人分心的人们或许从未体验过电子游戏的真正魅力</strong>。当然，对于论文这种需要前后高频率反复对照、有大量图表公式、需要用不同尺寸颜色的笔来即时标注的读物，尤其当这篇论文是双栏排版（在计算机各大会议中最为流行）的时候，打印机仍旧是最佳选择。</p>

<p>据称，人们绝大多数使用的应用只有七个，所以在此我强烈推荐我最喜欢的七个应用：</p>

<h3>1. Duokan (Free)</h3>

<p>书籍购买与阅读的一体化解决方案，你所想象得到的阅读需求它几乎都能够满足：买正版书、讨论、整理、摘录、笔记、阅读数据统计等等一系列贴心的设计。数据排版精美、价格合理，整个应用赏心悦目。最重要的是，多看书城支持国际行用卡支付，对于我们这些海外游子而言，着实是一处令人热泪盈眶的存在。唯一可惜的是，阅读器没有网页浏览器的版本，尽管它支持iOS/Android/Kindle等移动设备。</p>

<h3>2. GoodReader (Free/$4.99)</h3>

<p>既然阅读，就必然需要对任何文本格式做任何可能的处理，GoodReader似乎支持绝大部分的文本格式。而对我而言，PDF足矣。此前还从未有任何体验会让我惊呼：这货在PDF上做标注如有神助！</p>

<h3>3. Kindle (Free)</h3>

<p>某些资源在互联网上死也搜不到开放的版本，这时候只能求助于亚马逊了；尽管设计体验一般，书籍略贵，但是全平台支持，绝对够用。</p>

<h3>4. 豆瓣阅读 HD (Free)</h3>

<p>与豆瓣无缝衔接，与Duokan（多看）书城互为补充。有比较强大的网页版本的阅读器，尽管iOS的应用暂时不好用，不支持笔记等操作。不支持国际信用卡支付。</p>

<h3>5. 读知乎 (Free)</h3>

<p>尝试了解“我不知道自己不知道什么事情”对我来说很重要，而知乎能够帮助我发现更大的世界。</p>

<h3>6. TeamViewer (Free)</h3>

<p>极为方便的远程桌面应用，无论是自己在多台电脑间交互、还是远程协助他人，这个都是不二之选。</p>

<h3>7. StumbleUpon (Free)</h3>

<p>原理同5，同样是为了尝试了解“我不知道自己不知道什么事情”。人生往往需要不期而遇的惊喜！</p>

<p>最后，我已经放弃了阅读新闻的习惯：几乎所有人都知道的新闻99%对我是没有价值的，不看也罢。至于Google Reader的替代品，Feedly原来做得极差，最新版本的好了许多，Digg Reader和<a href="http://theoldreader.com/">the Old Reader</a>都不错.</p>

<p>EOF</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header class="page-header">
    
      <h1 class="entry-title"><a href="/blog/2013/08/14/essential-c-sharp-basics/">Essential C# 4.0: Basics</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-08-14T10:23:00-07:00" pubdate data-updated="true">Aug 14<span>th</span>, 2013</time>
        
         | <a href="/blog/2013/08/14/essential-c-sharp-basics/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>No one can ever master a programming language (PL) by studying it only without looking into and comparing it with other ones. Modern application software often requires a variety of components written in different PLs. Most importantly, language itself is not important at all; at least not important when compared to the fundamental ideas on architectures, frameworks, the design of the PL. A competing programmer can always get the hang of any PLs quickly.</p>

<p>Consequently, I make a list of PLs I would study seriously in the future.</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2013/08/14/essential-c-sharp-basics/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header class="page-header">
    
      <h1 class="entry-title"><a href="/blog/2013/06/11/%5B%3F%5D-ben-chu-chuang-gong-si-de-hui-yi-lu-%3C%3Cda-zao-facebook%3E%3E/">中国工程师在初创公司的经验总结&#8211;《打造Facebook》</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-06-11T20:38:00-07:00" pubdate data-updated="true">Jun 11<span>th</span>, 2013</time>
        
         | <a href="/blog/2013/06/11/%5B%3F%5D-ben-chu-chuang-gong-si-de-hui-yi-lu-%3C%3Cda-zao-facebook%3E%3E/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>这是一本无趣的书，甚至都不能被称作一本书，而更像是国内某大学老师上课的讲义，兼具冗余繁杂、事后诸葛亮。不可否认，的确有一些新奇的东西在里面，但无论怎么看都不禁让人疑惑：是不是原作者根据工作心得列了一份提纲，然后随意找了个写手照本宣科地添加了些文字？难道作者的目标群体仅仅就是些大一大二的学生么？</p>

<p>当然，无论这本书水平如何，毕竟来自大名鼎鼎的Facebook，我们这些后生们怎么着也得战战兢兢地读完啊……</p>

<p>以下是我的阅读笔记：</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2013/06/11/%5B%3F%5D-ben-chu-chuang-gong-si-de-hui-yi-lu-%3C%3Cda-zao-facebook%3E%3E/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header class="page-header">
    
      <h1 class="entry-title"><a href="/blog/2013/06/01/2013nian-wu-yue-fen-yue-du-ji-lu/">2012年9月至2013年5月阅读记录</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-06-01T21:12:00-07:00" pubdate data-updated="true">Jun 1<span>st</span>, 2013</time>
        
         | <a href="/blog/2013/06/01/2013nian-wu-yue-fen-yue-du-ji-lu/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>在来到耶鲁的九个月中，迫于自高中以来最大的学习压力，阅读量较小，总共读了约莫13本书，其中4、6、10、11算是重读。一度赶在停产之前购置了Kindle DXG ，意图博览盗版书，后来才发现系统与Kindle 3 相比 简直烂到了极致，不仅不能做笔记，更加凶残的是无法原生支持中文。连多看系统都已经不再为DXG更新。</p>

<p>现在我来简单讲讲这些书的读后感。</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2013/06/01/2013nian-wu-yue-fen-yue-du-ji-lu/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header class="page-header">
    
      <h1 class="entry-title"><a href="/blog/2013/06/01/bo-lan-zhuang-kuo-de-gai-ge-kai-fa-shi-hua-%3C%3Cji-dang-san-shi-nian-%3E%3E-du-hou-gan/">波澜壮阔的改革开放史话——《激荡三十年》读后感</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-06-01T11:32:00-07:00" pubdate data-updated="true">Jun 1<span>st</span>, 2013</time>
        
         | <a href="/blog/2013/06/01/bo-lan-zhuang-kuo-de-gai-ge-kai-fa-shi-hua-%3C%3Cji-dang-san-shi-nian-%3E%3E-du-hou-gan/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>自1978年改革开放以来，中国经济突飞猛进，摸着石头过河让这片蓝海充满了危险、机遇以及不确定性，然而混沌孕新生，乱世出英雄，一大批企业家们迅速地完成了原始积累；当然，我们也不能忘记路边的累累白骨：他们都是国富民强最直接的功臣，是新时代最伟大的英雄。</p>

<p>他们要么是想人之不敢想，打改革的擦边球，有勇气面对风险，风险有多大，他们最后就取得了多大的成就；要么是运用专业头脑，或者引进外国的先进技术或者理念，步步为营。后生们想要有所建树，最简单直接的办法就是单点快速突破，继而精益求精。</p>

<p>以下是我整理的一些摘录。</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2013/06/01/bo-lan-zhuang-kuo-de-gai-ge-kai-fa-shi-hua-%3C%3Cji-dang-san-shi-nian-%3E%3E-du-hou-gan/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header class="page-header">
    
      <h1 class="entry-title"><a href="/blog/2013/05/14/ren-sheng-shi-yuan/">人生十愿</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-05-14T04:18:00-07:00" pubdate data-updated="true">May 14<span>th</span>, 2013</time>
        
         | <a href="/blog/2013/05/14/ren-sheng-shi-yuan/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>毕业啦！</p>

<p>世事总不尽如人意，而贪心如我者，尝试写下人生的十个愿望；倘若某日能够实现十之八九，也就算是此生无悔啦！</p>

<ol>
<li>月高风黑的时候总是可以拉上三五好友宵夜。老到住进养老院的时候总有大爷大妈陪着打麻将。</li>
<li>亲朋好友，还有我，都能够快乐健康地活着，不求有多大的出息，但求日子过得欢喜，无论多舒适还是多苦逼，都能够坚持自己选择的路，得瑟得瑟屁颠屁颠地走下去。</li>
<li>有个萌妹子一起玩儿，我们都有健美的体魄心态和性格，开开心心玩上一辈子。</li>
<li>拥有一家自己的互联网公司，创造有趣有用的产品，这是时代赋予青年们的使命。感激上苍让我们CSer成为时代的弄潮儿。</li>
<li>拿到一个PhD学位，不仅是因为“谁有知识我就对谁佩服得五体投地”，而且理想主义的说，他们至少对人类知识做出了一丁点儿的贡献。完全没有贡献？那就不要浪费时间啦！</li>
<li>写一本好书、绘一幅好画、填一篇好诗词、吟一支小曲儿、拍一部好电影。</li>
<li>有精力、财力或者智力帮助他人，尤其是年轻人。</li>
</ol>


<p>剩下的三个，以后再许！</p>

<p>EOF</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header class="page-header">
    
      <h1 class="entry-title"><a href="/blog/2013/04/06/dynamo-kv-store/">Dynamo: Amazon&#8217;s Highly Available Key-value Store (SOSP&#8217;07)</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-04-06T14:16:00-07:00" pubdate data-updated="true">Apr 6<span>th</span>, 2013</time>
        
         | <a href="/blog/2013/04/06/dynamo-kv-store/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>From <a href="http://www.allthingsdistributed.com/2007/10/amazons_dynamo.html">Amazon</a></p>

<h3>Comments</h3>

<p>Dynamo successfully builds a highly available and scalable data store, which sacrifices consistency under certain failure scenarios but the data storage is still eventually consistent. The system is complex and thus this paper involves a huge number of details. However, the paper could not specify all of them. Some interesting parts seem to be missing. What are the supporting techniques used in Dynamo? How is it compared to other existing KV distributed store systems? Are there any possible extensions or future works?</p>

<p>This paper assumes that security concerns can be ignored for its internal use. Theoretically, security problems is still possible. At least, how can the administrator detect sybil attacks?</p>

<p>The author tried three partition schemes. The latter versions decouple partitioning and partition placement. The placement is changeable at run time. Consequently, the strategy 3 has a better efficiency. And the system recovers faster and it is easier to archive. However, the key space is partitioned equally into Q partitions, and every node assume Q/S tokens per node. The strategy 3 in Figure 7 is a little confusing. The author should specify that the span each node is responsible for is SIMILAR IN SIZE to each other, instead of exactly EQUAL IN SIZE to each other.</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2013/04/06/dynamo-kv-store/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header class="page-header">
    
      <h1 class="entry-title"><a href="/blog/2013/01/27/hadoopdb-vldb-09/">HadoopDB (VLDB&#8217;09)</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-01-27T15:50:00-08:00" pubdate data-updated="true">Jan 27<span>th</span>, 2013</time>
        
         | <a href="/blog/2013/01/27/hadoopdb-vldb-09/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p><a href="http://db.cs.yale.edu/hadoopdb/hadoopdb.html">Yale DB</a></p>

<h3>Comments</h3>

<p>Two ways to improve HadoopDB</p>

<ol>
<li>Integrate the file system for local database with HDFS. In the design of HadoopDB, the file system and the database are separated, which means that the more space one part is preallocated and the less space the other part will occupy. This design is not scalable because the system administrator has to partition the space by hand. We could investigate a way to let the database run on the HDFS directly. The database&#8217;s file descriptor can be adapted to HDFS directly. Or, even better, we can add an extra virtualized layer between the database and the HDFS.</li>
<li>Set up a better scheduler. It is mentioned in the paper that the original version of hadoop fair scheduler is not so good. It is queue-based and locally greedy and simply does not consider the big picture much. &#8220;Quincy: Fair Scheduling for Distributed Computing Clusters&#8221; advances a flow-based algorithm, which has a very good performance by increasing the throughput up to 40%.</li>
</ol>


</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/2013/01/27/hadoopdb-vldb-09/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header class="page-header">
    
      <h1 class="entry-title"><a href="/blog/2013/01/14/gc-garbage-collection-in-java/">GC(Garbage Collection) in Java</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-01-14T00:18:00-08:00" pubdate data-updated="true">Jan 14<span>th</span>, 2013</time>
        
         | <a href="/blog/2013/01/14/gc-garbage-collection-in-java/#disqus_thread">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>本文摘录自<a href="http://www.amazon.com/Thinking-Java-4th-Bruce-Eckel/dp/0131872486">Thinking in Java</a></p>

<h2>1. The method  <code>finalize()</code></h2>

<p><code>finalize()</code>使用时，会在GC释放空间之前被调用到，目的是在GC的时候做一些特殊的清理工作；但<strong>finalize()绝不是C++里面的destructor，因为</strong></p>

<p>1.对象<strong>不一定会</strong>被GC (而C++里析构函数一定会被调用到)</p>

<p>2.GC不等于析构</p>

<p>既然有GC，Java就没有必要用到析构函数，所以如果有需要在GC时候额外做些事情，就使用finalize()做最后的清理工作，<strong>尽管它不一定会被调用到，除非JVM没有内存空间了</strong>。</p>

<p>3.GC仅和内存有关</p>

<p>既然Java本身内存回收问题就被GC解决了，为什么还要finalize()呢？<strong>因为，Java可能内嵌其他语言的代码，如果有类似C的内存处理函数malloc()，就必须要手动写free()。</strong>因此，finalize()极少会被用到。</p>

<p>C++创建对象的位置有两种，一是创建在本地的stack上，自动销毁于本段代码的回花括号处，另一个是创建在heap上，必须用<strong>delete</strong>手动销毁。Java不允许创建本地对象，必须使用<strong>new</strong>，但是既然有了GC就不用delete.</p>

<p>总之，要记住的是，GC和finalize()并不总会被调用到。</p>

<p>finalize()可以用到debug，代码如下</p>

<figure class='code'><figcaption><span>TerminationCondition.java</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'> <span class="kd">class</span> <span class="nc">Book</span> <span class="o">{</span>
</span><span class='line'>    <span class="kt">boolean</span> <span class="n">checkedOut</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
</span><span class='line'>    <span class="n">Book</span><span class="o">(</span><span class="kt">boolean</span> <span class="n">checkOut</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">checkedOut</span> <span class="o">=</span> <span class="n">checkOut</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>    <span class="kt">void</span> <span class="nf">checkIn</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">checkedOut</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">finalize</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>      <span class="k">if</span><span class="o">(</span><span class="n">checkedOut</span><span class="o">)</span>
</span><span class='line'>        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Error: checked out.&quot;</span><span class="o">);</span>
</span><span class='line'>        <span class="c1">// Normally, you’ll also do this:</span>
</span><span class='line'>        <span class="c1">// super.finalize(); // Call the base-class version</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">public</span> <span class="kd">class</span> <span class="nc">TerminationCondition</span> <span class="o">{</span>
</span><span class='line'>    <span class="c1">//static Test monitor = new Test();</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">Book</span> <span class="n">novel</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Book</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span><span class='line'>      <span class="c1">// Proper cleanup:</span>
</span><span class='line'>      <span class="n">novel</span><span class="o">.</span><span class="na">checkIn</span><span class="o">();</span>
</span><span class='line'>      <span class="c1">// Drop the reference, forget to clean up:</span>
</span><span class='line'>      <span class="k">new</span> <span class="nf">Book</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
</span><span class='line'>      <span class="c1">// Force garbage collection &amp; finalization:</span>
</span><span class='line'>      <span class="n">System</span><span class="o">.</span><span class="na">gc</span><span class="o">();</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>  <span class="cm">/* output:</span>
</span><span class='line'><span class="cm"> Error: checked out.</span>
</span><span class='line'><span class="cm"> */</span>
</span></code></pre></td></tr></table></div></figure>


<p>此处，<code>System.gc()</code> 强制<code>finalize()</code>必须执行。<strong>如果有finalize(),一般情况下，父类的finalize()也必须被执行到</strong>，所以<code>Book.finalize()</code>中有<code>super.finalize()</code>。</p>

<h2>2. GC的工作机制</h2>

<p>Java中在heap上new东西并不像其他语言那么expensive，几乎和其他语言在stack上创建对象一样快。</p>

<p>非Java的GC机制：<em>reference counting</em> 数对象被引用了多少次，当等于零时就被清理掉。</p>

<p>Java的机制：<strong><em>adaptive generational stop-and-copy mark-and-sweep.</em></strong> 所有未死的对象都可以追溯到stack或者static storage上的一个引用，形成一个个web。这时候，也有不同的处理方式：</p>

<ol>
<li><em>stop-and-copy</em>. 如果程序停下来了，将活的对象拷贝到新的heap上，垃圾就被留在了原来的heap。新heap上的对象也可以被排列得更加紧凑(compact)了。有两个问题：

<ul>
<li>保持两个heap</li>
<li>周期性拷贝，即便没有new新的东西，或者产生的垃圾很少，会导致浪费，所以需要另一个机制处理这种特殊的情况</li>
</ul>
</li>
<li><em>mark-and-sweep</em>. 比较慢，但是在产生少量垃圾或者没有垃圾时候非常快。做法是，标记活对象，所有的标记完成后，扫除没有标记的对象。</li>
</ol>


<p>如何做到adaptive地进行转化呢？JVM的内存分布在很多大的block当中。大的对象，可以独占block，不拷贝，而是增加其<em>generation count</em>，内含小对象的block则会被拷贝并整理。JVM会进行监视,如果所有对象都很稳定,GC效率降低的话,就切换到<em>mark-and-sweep</em>;同样, JVM会注意其效果,要是heap出现很多碎片,就会切换回<em>stop-and-copy</em>。</p>

<p>EOF</p>
</div>
  
  


    </article>
  
  <ul class="pager">
    
    <li class="previous"><a href="/blog/page/2/">&larr; Older</a></li>
    
    <li><a href="/blog/archives">Blog Archives</a></li>
    
  </ul>
</div>
<aside class="sidebar-nav span3">
  
    <section class="well">
  <script src="/javascripts/onmouseoverpuncsky.js" type="text/javascript"> </script>
  <img onmouseover="enlight(this)" onmouseout="darken(this)" src="/puncsky-gray.png" alt="puncsky" style="max-width:100%;">
  <h4>Puncsky</h4>
  <p><i>who strives on and lives to strive</i></p>
  <p><a href="https://www.github.com/puncsky/">Github</a></p>
</section>
<section class="well">
  <ul id="recent_posts" class="nav nav-list">
    <li class="nav-header">Recent Posts</li>
    
      <li class="post">
        <a href="/blog/2013/09/05/essential-c-sharp-intermediate/">Essential C# 4.0: Intermediate</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/09/02/ipadmini/">我的iPad安装的应用</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/08/14/essential-c-sharp-basics/">Essential C# 4.0: Basics</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/06/11/%5B%3F%5D-ben-chu-chuang-gong-si-de-hui-yi-lu-%3C%3Cda-zao-facebook%3E%3E/">中国工程师在初创公司的经验总结&#8211;《打造Facebook》</a>
      </li>
    
      <li class="post">
        <a href="/blog/2013/06/01/2013nian-wu-yue-fen-yue-du-ji-lu/">2012年9月至2013年5月阅读记录</a>
      </li>
    
  </ul>
</section>
<section class="well">
	<div id="clustrmaps-widget"></div><script type="text/javascript">var _clustrmaps = {'url' : 'http://www.puncsky.com', 'user' : 1100959, 'server' : '2', 'id' : 'clustrmaps-widget', 'version' : 1, 'date' : '2013-06-24', 'lang' : 'en', 'corners' : 'square' };(function (){ var s = document.createElement('script'); s.type = 'text/javascript'; s.async = true; s.src = 'http://www2.clustrmaps.com/counter/map.js'; var x = document.getElementsByTagName('script')[0]; x.parentNode.insertBefore(s, x);})();</script><noscript><a href="http://www2.clustrmaps.com/user/92810cc9f"><img src="http://www2.clustrmaps.com/stats/maps-no_clusters/www.puncsky.com-thumb.jpg" alt="Locations of visitors to this page" /></a></noscript>
</section>






  
</aside>

    </div>
  </div>
  <footer role="contentinfo" class="page-footer"><hr>
<p>
  Copyright &copy; 2013 - Tian -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'puncsky';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
