
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Crack the System Design Interview - Puncsky CS Notebook</title>
  <meta name="author" content="Tian">

  
  <meta name="description" content="Life and computer science notebook from Puncsky">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://www.puncsky.com/blog/2015/12/19/crack-the-system-design-interview">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/bootstrap/bootstrap.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/stylesheets/bootstrap/responsive.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/stylesheets/syntax/syntax.css" media="screen, projection" rel="stylesheet" type="text/css">
  <style type="text/css">
    body {
      padding-bottom: 40px;
    }
    h1 {
      margin-bottom: 15px;
    }
    img {
      max-width: 100%;
    }
    .sharing, .meta, .pager {
      margin: 20px 0px 20px 0px;
    }
    .page-footer p {
      text-align: center;
    }
  </style>
  <script src="/javascripts/libs/jquery.js"></script>
  <script src="/javascripts/libs/modernizr-2.0.js"></script>
  <script src="/javascripts/libs/bootstrap.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Puncsky CS Notebook" type="application/atom+xml">
  <link href="http://fonts.googleapis.com/css?family=Ubuntu:300,400,500,700,300italic,400italic,500italic,700italic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,500italic,700italic,300,400,500,700,800" rel="stylesheet" type="text/css">
<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js">
  MathJax.Hub.Config({
   extensions: ["tex2jax.js","TeX/AMSmath.js","TeX/AMSsymbols.js"],
   jax: ["input/TeX", "output/HTML-CSS"],
   tex2jax: {
       inlineMath: [ ['$','$'], ["\\(","\\)"] ],
       displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
   },
   "HTML-CSS": { availableFonts: ["TeX"] }
  });
</script>

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-43072488-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <nav role="navigation"><div class="navbar navbar-inverse">
  <div class="navbar-inner">
    <div class="container">
      <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </a>

      <a class="brand" href="/">Puncsky CS Notebook</a>

      <div class="nav-collapse">
        <ul class="nav">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/notes">Notes</a></li>
</ul>


        <ul class="nav pull-right" data-subscription="rss">
          <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
          
        </ul>

        
          <form class="pull-right navbar-search" action="http://google.com/search" method="get">
            <fieldset role="search">
              <input type="hidden" name="q" value="site:www.puncsky.com" />
              <input class="search-query" type="text" name="q" results="0" placeholder="Search"/>
            </fieldset>
          </form>
        
      </div>
    </div>
  </div>
</div>
</nav>
  <div class="container">
    <div class="row-fluid">
      
<article class="hentry span9" role="article">

  
  <header class="page-header">
    
      <h1 class="entry-title">Crack the System Design Interview</h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-12-19T16:54:00-08:00" pubdate data-updated="true">Dec 19<span>th</span>, 2015</time>
        
         | <a href="#disqus_thread">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p>How important is the system design interview? Not important for a new grad interviewing for an entry level position, but it will definitely be a highlight, if the new grad plays it well. Wait! Not all of us programmers are junior. And there are so many tutorials, frameworks, infrastructures to help you build your application. Building applications is not a hard thing, but having the vision of the overall architecture really makes a difference. So we have to crack the system interview sooner or later in our career as a software engineer or engineering manager.</p>

<p>Interviewers are looking for future teammates that they like to work with. The future teammates would better, at least, be capable of solving problems independently. There are so many choices for the solution, but not all of them are the best given some context. So the interviewee has to specify different choices and their tradeoffs. To summarize it, <strong>System design interview is a happy show-off of your knowledge on architectures, technologies, and tradeoffs. In an ideal case, keep talking what the interviewer expect throughout the interview, instead of letting them ask.</strong></p>

<p>Keep talking for 45 min could be easy, as long as you are armed with the following <strong>four steps and three common topics</strong>. Take <strong>&#8220;design Pinterest&#8221;</strong> for example.</p>

<h2>1. Four steps to Crack the System Design Interview</h2>

<p>Breaking up a complex task into small blocks helps you handle them with better paces and in actionable ways.</p>

<h3>1.1 Step 1. Clarify Requirements and Specs</h3>

<p>First things first, the ultimate goals should always be clear.</p>

<p>Pinterest is a highly scalable photo-sharing service:</p>

<ul>
<li>features: user profile, upload photos, news feed, etc.</li>
<li>scaling out: horizontal scalability and micro services.</li>
</ul>


<h3>1.2 Step 2. Sketch High Level Design</h3>

<p><strong>Do not dive into details before drawing the big picture.</strong> Otherwise, digging into an unwanted direction would prevent you from giving a roughly correct solution in the first place. You will regret if you do not have time to finish the task.</p>

<p>OK, let us sketch the following picture and do not explain too much about the detailed implementation of those components.</p>

<p>So far so good! To some extent, you have solved the problem. Surely this multi-tier architecture works, no matter how badly you would specify later!</p>

<h3>1.3 Step 3. Discuss individual components and how they interact in details</h3>

<p>When we truly understand a system, we should be able to identify what is what and explain how they interact. Look at those components above in the picture and specify one by one. This could lead to more general discussions, like three common topics in the next section, and to more specific domains, like how to design the photo storage data layout&#8230;</p>

<h4>1.3.1 Load Balancer</h4>

<p>Generally speaking, load balancers fall into three categories:</p>

<ul>
<li>DNS Round Robin (rarely used): clients get a randomly-ordered list of IP addresses.

<ul>
<li>pros: easy to implement and free</li>
<li>cons: hard to control and not responsive, since DNS cache needs time to expire</li>
</ul>
</li>
<li>L3/L4 Load Balancer: traffic is routed by IP address and ports.L3 is network layer (IP). L4 is session layer (TCP).

<ul>
<li>pros: better granularity, simple, responsive</li>
</ul>
</li>
<li>L7 Load Balancer: traffic is routed by what is inside the HTTP protocol. L7 is application layer (HTTP).</li>
</ul>


<p>It is good enough to talk to this level in the topic, but in case the interviewer wants more, we can suggest exact algorithms like round robin, weighted round robin, least loaded, least loaded with slow start, utilization limit, latency, cascade, etc.</p>

<h4>1.3.2 Reverse Proxy</h4>

<p>Reverse proxy, like varnish, centralizes internal services and provides unified interfaces to the external. For examole, www.example.com/index and www.example.com/sports feel like coming from the same domain, but they are from different micro services behind the reverse proxy. Reverse proxy could also help with caching and load balance.</p>

<h4>1.3.3 (Frontend) Web Tier</h4>

<p>This is where web pages are served, and usually combine with the service tier in the very early stage of a web service.</p>

<h5>Stateless</h5>

<p><strong>There are two major bottlenecks of the whole system &#8211; requests per second and bandwidth.</strong> We could improve the situation by using more efficient tech stack, like frameworks with <a href="http://www.puncsky.com/blog/2015/01/13/understanding-reactor-pattern-for-highly-scalable-i-o-bound-web-server/">async and non-blocking reactor pattern</a>, and enhancing the hardware, like <strong>scaling up (aka vertical scaling) or scaling out (aka horizontal scaling)</strong>.</p>

<p>Internet companies prefer scaling out, since it is more cost-efficient with a huge number of commodity machines. This is also good for recruiting, because the target skillsets are equipped by most of the talents in the job market.</p>

<p><strong>Frontend web tier and service tier must be stateless, so it would be extremely convenient to add or remove hosts, and then horizontal scalability is achieved.</strong> There could be a standalone service keeping the configuration states for other services.</p>

<h5>Web Application and API</h5>

<p><strong>MVC(MVT) or MVVC</strong> pattern is the dominant pattern in this layer. In the age of mobile computing, view can be as simple as serving the minimal package of data to the mobile devices, which is called <strong>web API</strong>. People believe the API could be shared by clients and browsers. And that is why <strong>single page web application</strong> becoming popular, especially with the assistance of frontend frameworks like react.js, angular.js, backbone.js, etc.</p>

<h4>1.3.4 App Service Tier</h4>

<p><strong>The single responsibility principle</strong> advocates small and autonomous services that work together, so that each service could do one thing well and do not block others. And small teams with small services can plan much more aggressively, for the sake of hyper-growth.</p>

<h5>Service Discovery</h5>

<p>How do those services find each other? <a href="http://www.slideshare.net/sauravhaloi/introduction-to-apache-zookeeper">Zookeeper</a> is a popular and centralized choice. Instances with name, address, port, etc. are registered into the path in ZooKeeper for each service. If one service does not know where to find another service, query Zookeeper for the location and remember it until unavailable.</p>

<p>Zookeeper is CP system in terms of CAP theorem, which means it is consistent in case of failures, but the leader will be not available for registering new services.</p>

<p>In contrast to Zookeeper, Uber is doing interesting work in a decentralized way, named <a href="https://github.com/uber/hyperbahn">hyperbahn</a>, based on <a href="https://github.com/uber/ringpop-node">Ringpop consisten hash ring</a>. Read Amazon&#8217;s Dynamo for understanding AP and eventual consistency.</p>

<h5>Micro Services</h5>

<p>For designing Pinterest, those specific services could be user profile, follower, feed, search, spam, etc. Any of those topics could lead to in-depth discussions. Useful links are listed in the last section, future studies, to help you deal with them.</p>

<p>However, for a generalized interview question like &#8220;design Pinterest&#8221;, it is good enough for just having those services drawn as boxes. If we want to show more passions, trying to write down some sample endpoints / APIs for those services would be great.</p>

<h4>1.3.5  Data Tier</h4>

<p>Although a relational database can do almost all the storage work, please remember <strong>do not save blob, like photo, into a relational database, and choose the right database for the right service.</strong> As displayed in the architecture graph, follower service is demanding on read performance, so use a KV cache. Feeds are generated as time passing by, HBase&#8217;s timestamp index fits the user case very well. Users have relationships with other users or objects, so a relational database is our choice by default in a user profile service.</p>

<p>Data and storage is a rather broad and general topic, and we will discuss it later in Section 2.</p>

<h3>1.4 (Optional) Step 4. Back-of-the-envelop Calculation</h3>

<p>The final step about estimating how many machines are required is absolutely optional, because time is almost up after all the discussions above and three common topics below. In case you meet this, you would better prepare it as well. It is a little tricky&#8230; you need to assume variables and give a function first, and then guess the exact values for those variables, and finally calculate the result.</p>

<p>The cost is a function of CPU, RAM, storage, bandwidth, number and size of the images uploaded each day.</p>

<ul>
<li><em>N</em> users 10<sup>10</sup></li>
<li><em>i</em> images / (user * day) 10</li>
<li><em>s</em> size in bytes / image 10<sup>6</sup></li>
<li>viewed <em>v</em> times / image 100</li>
<li><em>d</em> days</li>
<li><em>h</em> requests / sec 10<sup>4</sup>   (bottleneck)</li>
<li><em>b</em> bandwidth (bottleneck)</li>
<li>Server cost: $1000 / server</li>
<li>Storage cost: $0.1 / GB</li>
<li>Storage = Nisd</li>
</ul>


<p><em>Number of required servers = max(Niv/h, Nivs/b)</em></p>

<h2>2 Three common Topics</h2>

<p>In Section 1.3 above, there are three common topics that could be applied to almost every system design question. They are extracted and summarized in this section.</p>

<h3>2.1 Communication</h3>

<p>How do different components interact with each other? &#8211; communication protocols.</p>

<p>General comparison of those protocols.</p>

<ul>
<li>UDP and TCP are both transport layer protocols. TCP is reliable and connection-based. UDP is connectionless and unreliable.</li>
<li>HTTP is in application layer. It is normally TCP based since HTTP assumes a reliable transport.</li>
<li>RPC, an application layer protocol, is an inter-process communication that allows a computer program to cause a subroutine or procedure to execute in another address space (commonly on another computer on a shared network), without the programmer explicitly coding the details for this remote interaction. That is, the programmer writes essentially the same code whether the subroutine is local to the executing program, or remote. When the software in question uses object-oriented principles, RPC is called remote invocation or remote method invocation (RMI).</li>
</ul>


<p>Here is a graph showing how RPC works.</p>

<p>Stub procedure: a local procedure to marshal the procedure identifier and the arguments into a request message, which it sends via its communication module to the server. When the reply message arrives, it unmarshals the results.</p>

<p>HTTP APIs are usually following RESTful style.</p>

<ul>
<li>REST(Representational state transfer of resources)

<ul>
<li>Best practice of HTTP API to interact with resources.</li>
<li>URL only decides the location. Headers (Accept and Content-Type, etc.) decide the representation. HTTP methods(GET/POST/PUT/DELETE) decide the state transfer.</li>
<li>minimize the coupling between client and server (a huge number of HTTP infras on various clients, data-marshalling).</li>
<li>Stateless and scaling out.</li>
<li>service partitioning feasible.</li>
<li>Public API.</li>
</ul>
</li>
</ul>


<p>You do not have to implement your own RPC protocols, since there are off-the-shelf frameworks.</p>

<ul>
<li>Google Protobuf: open source version does not have RPC implementations but only API. Smaller serialized data and slightly faster. Better documentations and cleaner APIs.</li>
<li>Facebook Thrift: support more languages, richer data structures(support richer data structures: List/Set/Map, etc，Protobuf不支持。Usercase: Hbase/Cassandra/Hypertable/Scrib/..  Incomplete documentation and hard to find good examples.</li>
<li>Apache Avro: Avro is heavily used in the hadoop ecosystem. It is based on dynamic schemas in Json. It features dynamic typing, untagged data, and no manually-assigned field IDs.

<h3>2.2 Storage</h3></li>
</ul>


<h3>2.3 CAP</h3>

<p>Consistency: all nodes see the same data at the same time
Availability: a guarantee that every request receives a response about whether it succeeded or failed
Partition tolerance: system continues to operate despite arbitrary message loss or failure of part of the system</p>

<p>三者只能取二，分布式系统通常AP, CP取一</p>

<p>CAP 原则是第一原则，系统设计之初就考虑侧重 CP 还是 AP</p>

<p>rDBMS 取 CP
NoSQL 取 AP</p>

<p>Cold standby, Warm standby, Hot standby, Active-active</p>

<h2>3 Future Studies</h2>

<p>Just as everything else, preparation and practice always makes perfect.</p>

<h2>- <a href="https://github.com/checkcheckzz/system-design-interview">System design interview for IT companies</a></h2>

<p>EOF</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Tian</span></span>

      








  


<time datetime="2015-12-19T16:54:00-08:00" pubdate data-updated="true">Dec 19<span>th</span>, 2015</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/big-data/'>big_data</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://www.puncsky.com/blog/2015/12/19/crack-the-system-design-interview/" data-via="" data-counturl="http://www.puncsky.com/blog/2015/12/19/crack-the-system-design-interview/" >Tweet</a>
  
  
  
</div>

    
    
    <section>
      <h1>Comments</h1>
      <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
    </section>
    
    <ul class="pager">
      
      <li class="previous"><a class="basic-alignment left"
        href="/blog/2015/05/06/suffering-oriented-programming/" title="Previous Post:
        面向痛苦编程 (译文)">&laquo; 面向痛苦编程 (译文)</a></li>
      
      <li><a href="/blog/archives">Blog Archives</a></li>
      
      <li class="next"><a class="basic-alignment right" href="/blog/2015/12/22/da-xue-de-ling-hun-yu-wei-du/"
        title="Next Post: 大学的灵魂与维度">大学的灵魂与维度
        &raquo;</a></li>
      
    </ul>
  </footer>
</article>

<aside class="sidebar-nav span3">
  
    <section class="well">
  <script src="/javascripts/onmouseoverpuncsky.js" type="text/javascript"> </script>
  <img onmouseover="enlight(this)" onmouseout="darken(this)" src="/puncsky-gray.png" alt="puncsky" style="max-width:100%;">
  <h4>Puncsky</h4>
  <p><i>He who strives on and lives to strive can earn redemption still.</i></p>
  <p><a href="https://www.github.com/puncsky/">Github</a></p>
</section>
<section class="well">
  <ul id="recent_posts" class="nav nav-list">
    <li class="nav-header">Recent Posts</li>
    
      <li class="post">
        <a href="/blog/2015/12/22/da-xue-de-ling-hun-yu-wei-du/">大学的灵魂与维度</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/12/19/crack-the-system-design-interview/">Crack the System Design Interview</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/05/06/suffering-oriented-programming/">面向痛苦编程 (译文)</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/02/04/callbacks-as-our-generations-goto/">Miguel de Icaza: Callbacks 就像我们这一代人的 Go To 语句</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/01/13/understanding-reactor-pattern-for-highly-scalable-i-o-bound-web-server/">Understanding Reactor Pattern for Highly Scalable I/O Bound Web Server</a>
      </li>
    
  </ul>
</section>
<section class="well">
	<div id="clustrmaps-widget"></div><script type="text/javascript">var _clustrmaps = {'url' : 'http://www.puncsky.com', 'user' : 1100959, 'server' : '2', 'id' : 'clustrmaps-widget', 'version' : 1, 'date' : '2013-06-24', 'lang' : 'en', 'corners' : 'square' };(function (){ var s = document.createElement('script'); s.type = 'text/javascript'; s.async = true; s.src = 'http://www2.clustrmaps.com/counter/map.js'; var x = document.getElementsByTagName('script')[0]; x.parentNode.insertBefore(s, x);})();</script><noscript><a href="http://www2.clustrmaps.com/user/92810cc9f"><img src="http://www2.clustrmaps.com/stats/maps-no_clusters/www.puncsky.com-thumb.jpg" alt="Locations of visitors to this page" /></a></noscript>
</section>






  
</aside>


    </div>
  </div>
  <footer role="contentinfo" class="page-footer"><hr>
<p>
  Copyright &copy; 2016 - Tian -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'puncsky';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://www.puncsky.com/blog/2015/12/19/crack-the-system-design-interview/';
        var disqus_url = 'http://www.puncsky.com/blog/2015/12/19/crack-the-system-design-interview/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
